import { GradeType, SubjectType, AreaType, PassageLengthType, QuestionType, TextType } from '@/types';

// 학년별 프롬프트
const gradePrompts = {
  '초등학교 중학년(3-4학년)': `초등학교 중학년(3-4학년): 학습자는 짧은 문장 구조와 익숙한 단어를 중심으로 이해할 수 있습니다. 설명은 구체적인 사례와 생활 속 경험에 기반해야 하며, 새로운 개념어에는 간단한 풀이가 필요합니다. 추상적인 개념은 '왜 그럴까?', '무엇이 다를까?'와 같은 질문으로 흥미를 유도하고, 그림을 그리듯 서술해 주세요.`,
  
  '초등학교 고학년(5-6학년)': `초등학교 고학년(5-6학년): 학습자는 다소 긴 문장과 낯선 단어를 접할 수 있으며, 인과관계나 비교 같은 구조를 이해하기 시작합니다. 설명은 실생활 예시에서 출발해 원리나 개념으로 자연스럽게 확장되도록 구성하고, 낱말 풀이도 포함합니다. 경험을 바탕으로 '어떤 일이 일어날까?', '무엇이 원인일까?' 같은 탐구형 문장도 포함해 주세요.`,
  
  '중학생(1-3학년)': `중학생(1-3학년): 학습자는 개념 간의 연결과 간단한 논리 전개를 이해할 수 있으며, 비교·예측·과정 설명에 익숙해집니다. 문장은 다소 길어도 되며, 주제의 흐름을 따라가며 개념의 관계를 파악할 수 있도록 구조화해 주세요. 생소한 개념어는 풀이를 제공하되, 학술적 용어 사용도 일부 가능하며, 사고를 유도하는 질문을 도입부나 전개부에 포함해 주세요.`
};

// 영역별 프롬프트
const areaPrompts = {
  '일반사회': `일반사회: 사회 규범, 규칙과 법, 공동체의 질서, 시민의 권리와 책임 등 사회를 구성하는 제도와 원리를 설명합니다. 초등학생에게는 생활 사례를 통해 제시해 주세요. 중학생에게는 사회 참여와 제도적 구조를 단계적으로 소개할 수 있습니다. 지문 구성 시 제도의 의미와 작동 방식을 생활 속 예시로 연결해 주세요.`,
  
  '지리': `지리: 지형, 기후, 자연환경, 인문환경, 지도 읽기, 지역 간 교류 등 공간과 장소의 특성을 다룹니다. 초등 수준에서는 일상에서 접할 수 있는 자연·인문 환경을 소개하고, 위치나 방향 개념을 단순하게 전달합니다. 중학생 수준에서는 심화된 공간적 사고로 확장할 수 있습니다. 실생활 기반 질문으로 지리적 사고력을 유도하세요.`,
  
  '역사': `역사: 과거 사회의 모습, 주요 인물과 사건, 시대 구분, 변화와 지속성, 문화유산 등을 시간의 흐름 속에서 설명합니다. 초등은 친숙하고 스토리 기반의 접근이 효과적입니다. 중학생은 구조적 설명이 가능합니다. 지문 구성 시 시대적 맥락을 인물이나 사건 중심으로 스토리텔링하세요.`,
  
  '경제': `경제: 필요와 선택, 생산과 소비, 돈과 직업, 시장과 가격, 자원 배분, 경제 활동의 기본 원리를 다룹니다. 초등은 일상적 경제 활동을 중심으로, 상황을 제공합니다. 중학생은 구조적이고 제도적인 요소를 다룹니다. 실생활 사례를 통해 경제적 사고와 의사결정 과정을 경험하도록 지문을 구성해 주세요.`,
  
  '물리': `물리: 힘과 운동, 속력, 마찰, 에너지 전환, 빛과 소리, 전기와 자기 등 자연 현상의 기본 원리를 설명합니다. 초등은 놀이와 생활 도구를 예시로 사용하여 개념을 쉽게 설명합니다. 중학생은 정량적 또는 개념적 분석 중심으로 설명할 수 있습니다. 지문은 탐구 동기를 유도하는 질문으로 시작하세요.`,
  
  '화학': `화학: 물질의 상태(고체, 액체, 기체), 용해와 혼합, 변화(물리·화학), 연소, 산과 염기 등 물질의 성질과 변화를 다룹니다. 초등은 관찰 가능한 생활 속 현상 중심으로 개념을 도입해야 하며, 실험적 탐색을 서술로 표현해 주세요. 중학생은 심화된 개념을 간단한 실생활 반응과 연계하여 설명할 수 있습니다. 지문은 질문형으로 시작하세요.`,
  
  '생물': `생물: 식물과 동물의 구조와 기능, 생명의 특성, 성장과 번식, 감각기관, 생태계 구성과 상호작용을 설명합니다. 초등은 친숙한 생물체를 중심으로 생김새, 먹이, 자라는 과정 등을 관찰 기반으로 설명해야 합니다. 중학생은 정밀한 생명 현상을 구조적으로 다룰 수 있습니다. 호기심 기반으로 시작하여 생물학적 개념을 끌어내세요.`,
  
  '지구과학': `지구과학: 지구의 구조, 날씨와 계절 변화, 화산과 지진, 별과 행성, 지형의 생성, 기후와 환경 문제 등 우주와 지구 시스템을 설명합니다. 초등은 주변 자연 현상 중심으로 구성해야 합니다. 중학생은 심화된 주제를 이해 가능한 수준으로 구조적으로 제시합니다. 지문은 계절·천체 관련 질문으로 시작하세요.`
};

// 출력 형식 프롬프트
const outputFormats = {
  '4-5문장으로 구성한 5-6개 단락': `{
  "passages": [
    {
      "title": "<질문형·흥미유발형 제목>",
      "paragraphs": [
        "<4-5문장으로 구성한 단락1>",
        "<4-5문장으로 구성한 단락2>",
        "<4-5문장으로 구성한 단락3>",
        "<4-5문장으로 구성한 단락4>",
        "<4-5문장으로 구성한 단락5>",
        "<4-5문장으로 구성한 단락6(생략가능)>"
      ],
      "footnote": [
        "<단어1에 대한 설명>",
        "...(필요 단어 수에 맞게 추가)..."
      ]
    }
  ]
}`,
  
  '5-6문장으로 구성한 6개 단락': `{
  "passages": [
    {
      "title": "<질문형·흥미유발형 제목>",
      "paragraphs": [
        "<5-6문장으로 구성한 단락1>",
        "<5-6문장으로 구성한 단락2>",
        "<5-6문장으로 구성한 단락3>",
        "<5-6문장으로 구성한 단락4>",
        "<5-6문장으로 구성한 단락5>",
        "<5-6문장으로 구성한 단락6>"
      ],
      "footnote": [
        "<단어1에 대한 설명>",
        "...(필요 단어 수에 맞게 추가)..."
      ]
    }
  ]
}`,
  
  '1-2문장으로 구성한 10개 단락': `{
  "passages": [
    {
      "title": "<질문형·흥미유발형 제목>",
      "paragraphs": [
        "<1-2문장으로 구성한 단락1>",
        "<1-2문장으로 구성한 단락2>",
        "<1-2문장으로 구성한 단락3>",
        "<1-2문장으로 구성한 단락4>",
        "<1-2문장으로 구성한 단락5>",
        "<1-2문장으로 구성한 단락6>",
        "<1-2문장으로 구성한 단락7>",
        "<1-2문장으로 구성한 단락8>",
        "<1-2문장으로 구성한 단락9>",
        "<1-2문장으로 구성한 단락10>"
      ],
      "footnote": [
        "<단어1에 대한 설명>",
        "...(필요 단어 수에 맞게 추가)..."
      ]
    }
  ]
}`,
  
  '10문장 이하로 구성한 5개 단락': `{
  "passages": [
    {
      "title": "<질문형·흥미유발형 제목>",
      "paragraphs": [
        "<10문장 이하로 구성한 단락1>",
        "<10문장 이하로 구성한 단락2>",
        "<10문장 이하로 구성한 단락3>",
        "<10문장 이하로 구성한 단락4>",
        "<10문장 이하로 구성한 단락5>"
      ],
      "footnote": [
        "<단어1에 대한 설명>",
        "...(필요 단어 수에 맞게 추가)..."
      ]
    }
  ]
}`,
  
  '1-2문장으로 구성한 12개 단락': `{
  "passages": [
    {
      "title": "<질문형·흥미유발형 제목>",
      "paragraphs": [
        "<1-2문장으로 구성한 단락1>",
        "<1-2문장으로 구성한 단락2>",
        "<1-2문장으로 구성한 단락3>",
        "<1-2문장으로 구성한 단락4>",
        "<1-2문장으로 구성한 단락5>",
        "<1-2문장으로 구성한 단락6>",
        "<1-2문장으로 구성한 단락7>",
        "<1-2문장으로 구성한 단락8>",
        "<1-2문장으로 구성한 단락9>",
        "<1-2문장으로 구성한 단락10>",
        "<1-2문장으로 구성한 단락11>",
        "<1-2문장으로 구성한 단락12>"
      ],
      "footnote": [
        "<단어1에 대한 설명>",
        "...(필요 단어 수에 맞게 추가)..."
      ]
    }
  ]
}`
};

// 지문 유형별 프롬프트
const textTypePrompts = {
  '설명문': `설명문: 특정 대상, 현상, 개념을 명확하고 체계적으로 설명하는 글입니다. 객관적 사실에 기반하여 정보를 전달하며, 정의-특성-예시-결론의 구조로 구성합니다. 학년에 맞는 어휘로 개념을 쉽게 풀어서 설명하세요.`,
  
  '논설문': `논설문: 특정 주제에 대한 의견이나 주장을 논리적으로 전개하는 글입니다. 문제 제기-근거 제시-반박-결론의 구조를 가지며, 설득력 있는 근거와 사례를 활용합니다. 학년 수준에 맞는 논리적 사고를 유도하세요.`,
  
  '탐구문': `탐구문: 궁금한 점이나 문제를 해결하기 위해 탐구하는 과정을 담은 글입니다. 문제 발견-가설 설정-탐구 과정-결과 도출의 구조로 구성하며, 과학적 사고와 탐구 방법을 보여줍니다. 호기심을 자극하는 질문으로 시작하세요.`,
  
  '뉴스 기사': `뉴스 기사: 최근 일어난 사건이나 이슈를 객관적으로 보도하는 글입니다. 5W1H(누가, 언제, 어디서, 무엇을, 왜, 어떻게)를 포함하여 사실을 정확하고 간결하게 전달합니다. 헤드라인 형태의 제목을 사용하세요.`,
  
  '인터뷰': `인터뷰: 전문가나 관련자와의 대화를 통해 정보를 얻는 글입니다. 질문과 답변의 형식으로 구성하며, 인터뷰 대상자의 경험과 견해를 생생하게 전달합니다. 대화체를 활용하여 현장감을 살리세요.`,
  
  '동화': `동화: 교훈이나 메시지를 재미있는 이야기로 전달하는 글입니다. 등장인물과 사건을 통해 학습 내용을 자연스럽게 녹여내며, 상상력을 자극하는 요소를 포함합니다. "옛날 옛적에" 같은 동화적 표현을 사용하세요.`,
  
  '시': `시: 함축적이고 운율이 있는 언어로 감정과 사상을 표현하는 글입니다. 은유, 의인법 등의 표현 기법을 사용하여 학습 내용을 시적으로 형상화합니다. 운율과 리듬감을 고려하여 작성하세요.`,
  
  '대본': `대본: 연극이나 드라마의 형식으로 구성된 글입니다. 등장인물의 대화와 행동 지시문으로 이루어지며, 학습 내용을 극적 상황으로 표현합니다. 무대 지시문과 대사를 명확히 구분하여 작성하세요.`,
  
  '소설': `소설: 허구의 이야기를 통해 인물, 사건, 배경을 생생하게 그려내는 글입니다. 플롯과 갈등을 통해 학습 내용을 흥미롭게 전달하며, 서사적 구조를 갖춥니다. 묘사와 서술을 적절히 활용하세요.`
};

// 지문 생성 프롬프트 생성
export function generatePassagePrompt(
  grade: GradeType,
  length: PassageLengthType,
  subject: SubjectType,
  area: AreaType,
  topic?: string,
  textType?: TextType
): string {
  let prompt = `###지시사항
다음 입력값을 받아 학습 지문(passage)을 생성하십시오. 출력은 하나의 영역으로 구분합니다.
- passage: 입력 조건을 반영해 생성한 지문

모든 지문은 질문형·호기심 유발형 제목을 사용하고, 실생활 예시를 활용해 추상 개념을 설명해야 하며, 임의(random) 로직은 사용하지 않습니다.

###작성절차
1. 키워드 도출
- 학년·과목·영역·지문 길이를 파싱하여 ① 핵심 개념(기초→심화), ② 생활 연계 예시, ③ 학년별 어휘 수준을 도출합니다.
2. 지문(passages) 생성
- 도출한 가이드를 조합해 제목 1개와 본문을 작성합니다.
- 본문은 입력된 지문 길이 옵션(단락 수·문장 수) 규칙을 정확히 준수합니다.
- 새로운 개념어가 등장할 경우 footnote에 간단히 풀이를 기입합니다.
3. 흥미 요소 적용
- 도입부에 실생활 상황·질문을 배치하여 독자의 호기심을 자극합니다.
- 단순 설명문뿐 아니라 비교·예측·원인결과 등 다양한 서술 방식을 활용합니다.
4. 출력 생성
- 아래 [공통 출력 스키마] 형식을 준수한 JSON만 출력하십시오.
- 지정된 키가 없거나 데이터를 찾을 수 없으면 **"-"**로 표기합니다.

###학년
${gradePrompts[grade]}

###지문 길이
${length}

###과목
${subject}

###영역
${areaPrompts[area]}`;

  // 선택적 주제 추가
  if (topic && topic.trim()) {
    prompt += `

###주제
지정된 주제: "${topic}"
위 주제를 중심으로 ${area} 영역의 학습 내용과 연결하여 지문을 구성하세요. 주제가 영역과 자연스럽게 연결되도록 하고, 학습 목표를 달성할 수 있는 내용으로 작성하세요.`;
  }

  // 선택적 유형 추가
  if (textType && textType in textTypePrompts) {
    prompt += `

###글의 유형
${textTypePrompts[textType as keyof typeof textTypePrompts]}`;
  }

  prompt += `

###출력형식(JSON)
${outputFormats[length]}`;

  return prompt;
}

// 문제 생성 프롬프트 - 학년별
const questionGradePrompts = {
  '초등학교 중학년(3-4학년)': `초등학교 중학년(3-4학년): 간단한 단어와 짧은 문장 중심으로 문제를 구성합니다. 질문은 사실 확인이나 정의 이해에 초점을 맞추며, 보기/정답/해설은 직관적이고 명확해야 합니다. 어려운 용어나 개념어는 피하고, 지문에서 사용된 표현을 최대한 그대로 활용해 주세요.`,
  
  '초등학교 고학년(5-6학년)': `초등학교 고학년(5-6학년): 개념 간의 관계, 비교, 원인·결과 등 약간 복잡한 사고를 요구할 수 있습니다. 질문은 지문 내용을 바탕으로 추론하거나 판단할 수 있는 형식도 허용됩니다. 해설에는 핵심 개념 간의 연결 관계를 명확히 설명해 주세요.`,
  
  '중학생(1-3학년)': `중학생(1-3학년): 개념을 분석하거나 적용하는 사고력이 반영되어야 하며, 복합적 질문도 가능합니다. 질문은 단순 사실 확인을 넘어, 원리나 맥락 파악을 유도해야 하며, 정답 외 오답 보기도 관련 개념과 혼동될 수 있도록 정교하게 구성해 주세요.`
};

// 문제 유형별 프롬프트
const questionTypePrompts = {
  '객관식': `객관식: 질문에 대한 보기 5개를 생성합니다. 보기는 모두 지문과 관련되어야 하며, 오답도 그럴듯한 근거를 지녀야 합니다. 정답 번호를 명확히 표시하고, 해설은 왜 정답이 맞는지와 왜 다른 보기들이 틀렸는지를 포함합니다.`,
  
  '주관식': `주관식 단답형: 답이 단어 또는 짧은 문장으로 작성 가능한 문제를 생성합니다. 질문은 지문 내 주요 개념, 정의, 원인·결과 등을 묻는 형식이어야 하며, 정답과 해설은 구체적이고 학년 수준에 맞는 설명으로 구성해야 합니다.`
};

// 문제 출력 형식
const questionOutputFormats = {
  '객관식': `{
  "questionType": "객관식",
  "questions": [
    {
      "type": "일반",
      "question": "<질문>",
      "options": ["...", "...", "...", "...", "..."],
      "answer": "<정답 번호>",
      "explanation": "<해설>"
    },
    {
      "type": "보완",
      "question": "<질문>",
      "options": ["...", "...", "...", "...", "..."],
      "answer": "<정답 번호>",
      "explanation": "<해설>"
    },
    {
      "type": "보완",
      "question": "<질문>",
      "options": ["...", "...", "...", "...", "..."],
      "answer": "<정답 번호>",
      "explanation": "<해설>"
    }
  ]
}`,
  
  '주관식': `{
  "questionType": "주관식",
  "questions": [
    {
      "type": "일반",
      "question": "<질문>",
      "answer": "<정답 단어 또는 짧은 문장>",
      "explanation": "<해설>"
    },
    {
      "type": "보완",
      "question": "<질문>",
      "answer": "<정답 단어 또는 짧은 문장>",
      "explanation": "<해설>"
    },
    {
      "type": "보완",
      "question": "<질문>",
      "answer": "<정답 단어 또는 짧은 문장>",
      "explanation": "<해설>"
    }
  ]
}`
};

// 문제 생성 프롬프트 생성
export function generateQuestionPrompt(
  grade: GradeType,
  passage: string,
  questionType: QuestionType
): string {
  return `###지시사항
다음 입력값을 기반으로, 해당 지문 내용을 반영한 **문제 3개**를 생성하십시오.
- 일반 문제 1개와 보완 문제 2개를 생성합니다.
- 일반 문제는 학생이 처음 접하는 문제이며, 보완 문제는 오답 시 학습 강화를 위해 생성하는 구조입니다.
- 학년에 맞는 어휘 수준과 사고 수준을 반영해 난이도를 조절해야 합니다.
- 문제는 반드시 지문 내용 또는 개념을 기반으로 출제되어야 하며, 임의(random) 구성은 금지됩니다.

###지문
${passage}

###학년
${questionGradePrompts[grade]}

###문제유형
${questionTypePrompts[questionType]}

###출력형식(JSON)
${questionOutputFormats[questionType]}`;
}