# 학습 지문 및 문제 생성 시스템

AI를 활용하여 교육과정 기반의 맞춤형 학습 지문과 문제를 7단계 워크플로우로 생성하고, 완전한 콘텐츠 관리 시스템을 제공하는 웹 애플리케이션입니다.

## 🌟 주요 특징

- **7단계 워크플로우**: 지문 생성부터 최종 저장까지 체계적인 단계별 진행
- **완전한 콘텐츠 관리**: 생성된 콘텐츠의 실시간 편집, 조회, 관리
- **완전한 사용자 제어**: 각 단계에서 검토 및 수정 가능
- **다양한 문제 유형**: 어휘 문제 + 5가지 종합 문제 유형 (세트 단위 관리)
- **Cascading Dropdown**: 교육과정 기반의 계층적 선택 시스템 (Google Sheets 연동)
- **Google Sheets 연동**: 구조화된 데이터 저장 및 백업
- **스마트 페이지네이션**: 20/50/100개 단위 표시 및 효율적인 데이터 관리
- **반응형 UI**: 모바일 및 데스크톱 환경에 최적화
- **실시간 연결 테스트**: Google Sheets 연결 상태 확인 및 자동 복구

## 🎯 시스템 구성

### 📝 콘텐츠 생성 (7단계 워크플로우)
메인 페이지 (`/`)에서 진행되는 체계적인 콘텐츠 생성 과정

### 📊 콘텐츠 관리 (`/manage`)
생성된 모든 콘텐츠의 조회, 편집, 관리를 위한 통합 관리 시스템
- **리스트 보기**: 생성일, 과목, 구분, 학년, 영역, 대주제, 소주제, 문단수, 어휘수, 어휘문제수, 종합문제수
- **스마트 필터링**: 과목, 학년, 영역별 필터 및 키워드 검색
- **페이지네이션**: 20/50/100개 단위 표시, 스마트 페이지 네비게이션
- **통계 대시보드**: 총 콘텐츠 수, 문제 수, 최근 업데이트 정보

### 🔧 상세 편집 (`/manage/[setId]`)
개별 콘텐츠의 완전한 편집 기능을 제공하는 4개 탭 구조
- **지문 탭**: 제목 및 단락별 실시간 편집
- **어휘 탭**: 용어/설명/예시문장 개별 관리
- **어휘문제 탭**: 문제별 상세 편집
- **종합문제 탭**: 세트 단위 문제 관리 (기본문제 + 보완문제)

## 📋 7단계 워크플로우

### 1단계: 지문 생성
- 교육과정 기반 입력 (구분, 과목, 학년, 영역, 대주제, 소주제, 핵심 개념어)
- GPT-4.1을 활용한 맞춤형 지문 생성
- 최소 20+개 용어 포함된 지문 자동 생성

### 2단계: 지문 검토 및 수정
- 제목, 본문, 용어 설명 실시간 편집
- 단락 추가/삭제, 용어 추가/삭제 기능
- 미리보기를 통한 최종 확인

### 3단계: 어휘 문제 생성
- 지문의 용어를 기반으로 각 용어당 1개씩 어휘 문제 자동 생성
- 5지선다 객관식 문제
- 용어의 의미, 사용법, 맥락 이해 평가

### 4단계: 어휘 문제 검토 및 수정
- 각 문제의 질문, 선택지, 정답, 해설 편집
- 문제 추가/삭제 기능
- 용어별 문제 최적화

### 5단계: 종합 문제 생성
- **5가지 문제 유형**: Random, 단답형, 문단별 순서 맞추기, 핵심 내용 요약, 핵심어/핵심문장 찾기
- **Random 선택**: 4가지 유형을 3개씩 총 12개 문제
- **특정 유형 선택**: 선택한 유형으로 12개 문제
- **세트 구조**: 기본문제 + 보완문제 2개로 구성

### 6단계: 종합 문제 검토 및 수정
- 문제 유형별 분포 확인
- 세트 단위 문제 관리 (기본문제 + 보완문제)
- 각 문제의 상세 편집 (질문, 선택지, 정답, 해설)
- 문제 세트 추가/삭제

### 7단계: 최종 저장
- 전체 콘텐츠 요약 확인
- Google Sheets 구조화 저장
- 로컬 JSON 파일 백업
- 새로운 세트 시작 또는 관리 페이지 이동

## 🎛️ 콘텐츠 관리 시스템

### 📊 관리 대시보드 (`/manage`)

**📈 통계 카드**
- 총 콘텐츠 세트 수
- 총 어휘 문제 수  
- 총 종합 문제 수
- 전체 문제 수

**🔍 고급 필터링**
- **과목별 필터**: 사회, 과학 등
- **학년별 필터**: 3학년, 4학년, 5학년, 6학년, 중1, 중2, 중3
- **영역별 필터**: 일반사회, 지리, 역사, 물리, 화학, 생물 등
- **키워드 검색**: 제목, 주제, 키워드 통합 검색

**📋 상세 리스트**
- **생성일**: 콘텐츠 생성 시간 (최신순 정렬)
- **과목**: 교과 구분
- **구분**: 학습 단계 (초등 중학년/고학년, 중학생)
- **학년**: 대상 학년
- **영역**: 세부 영역 (일반사회, 물리 등)
- **대주제**: 교육과정 대주제
- **소주제**: 교육과정 소주제  
- **문단수**: 지문의 실제 단락 개수
- **어휘수**: 지문에 포함된 용어 개수
- **어휘문제수**: 생성된 어휘 문제 개수
- **종합문제수**: 생성된 종합 문제 개수
- **작업**: 상세보기(새창), 삭제

**📄 스마트 페이지네이션**
- 기본 표시: 20개
- 선택 옵션: 20개, 50개, 100개
- 스마트 페이지 번호 (최대 10개 페이지 표시)
- 총 데이터 수 및 현재 표시 범위 정보

### 🔧 상세 편집 시스템 (`/manage/[setId]`)

**4개 탭 구조로 완전한 편집 환경 제공**

#### 📄 **지문 탭**
- **제목 편집**: 실시간 제목 수정
- **단락 관리**: 
  - 각 단락 개별 편집 (textarea)
  - 단락 추가/삭제 기능
  - 최소 1개 단락 보장
- **실시간 저장**: 모든 변경사항 즉시 반영

#### 📚 **어휘 탭** 
- **3필드 구조**: 용어, 설명, 예시문장으로 분리 편집
- **정확한 파싱**: 정규표현식 기반 데이터 분석
- **용어 관리**:
  - 개별 필드 편집
  - 용어 세트 추가/삭제
  - 자동 형식 재구성

#### ❓ **어휘문제 탭**
- **문제별 편집**: 어휘, 질문, 선택지, 정답, 해설
- **정답 선택**: 드롭다운으로 선택지 중 정답 선택
- **문제 관리**: 개별 문제 추가/삭제
- **5지선다 구조**: 표준 객관식 문제 형태

#### 🧠 **종합문제 탭**
**혁신적인 세트 단위 관리**
- **세트 구조**: 기본문제 1개 + 보완문제 2개
- **시각적 구분**: 
  - 기본문제: 흰색 배경 + 파란색 테두리
  - 보완문제: 파란색 배경 + 노란색 배지
- **문제 유형 관리**: 단답형, 객관식 등
- **정답 시스템**:
  - 객관식: 선택지 중 드롭다운 선택
  - 주관식: 직접 입력
- **세트 관리**: 전체 세트 추가/삭제
- **개별 관리**: 보완문제 개별 추가/삭제

**🎯 새창 시스템**
- 관리 페이지에서 '상세' 클릭 시 새창으로 편집 페이지 열기
- 독립적인 편집 환경 제공
- 실시간 저장 기능

## 🔧 기술 스택

- **Frontend**: Next.js 15, React, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **AI**: OpenAI GPT-4.1 API
- **Database**: Google Sheets API (5개 시트 구조)
- **Deployment**: Vercel

## 🚀 설치 및 실행

1. 의존성 설치:
```bash
npm install
```

2. 환경 변수 설정 (`.env.local` 파일):
```env
# OpenAI API
OPENAI_API_KEY=your_openai_api_key_here

# Google Sheets API
GOOGLE_SHEETS_CLIENT_EMAIL=your_service_account_email_here
GOOGLE_SHEETS_PRIVATE_KEY=your_private_key_here
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id_here
```

3. 개발 서버 실행:
```bash
npm run dev
```

4. 프로덕션 빌드:
```bash
npm run build
npm start
```

## ⚙️ 환경 설정

### OpenAI API 설정
1. [OpenAI Platform](https://platform.openai.com/)에서 API 키 생성
2. `.env.local`에 `OPENAI_API_KEY` 설정

### Google Sheets API 설정
1. [Google Cloud Console](https://console.cloud.google.com/)에서 프로젝트 생성
2. Google Sheets API 활성화
3. 서비스 계정 생성 및 JSON 키 다운로드
4. Google Sheets 스프레드시트 생성 및 서비스 계정에 편집 권한 부여
5. `.env.local`에 관련 정보 설정

### Google Sheets 스키마 (5개 시트)

#### field 시트 ⭐ **필수** (계층적 선택을 위한 기본 데이터)
```
subject | grade | area | maintopic | subtopic | keyword
```
예시 데이터:
```
사회 | 3학년 | 일반사회 | 우리나라의 정치 | 민주주의와 시민 참여 | 민주주의, 시민 참여, 선거
사회 | 4학년 | 일반사회 | 사회 제도와 기관 | 지방 자치와 시민 생활 | 지방자치, 시민참여, 공공서비스
과학 | 3학년 | 생물 | 동물의 생활 | 동물의 특징 | 서식지, 먹이, 생김새
```

> 💡 **중요**: field 시트가 없거나 비어있으면 계층적 선택이 작동하지 않고 기본 데이터만 사용됩니다.

#### final_sets 시트 (메인 데이터) ⭐ **업데이트됨**
```
timestamp | setId | division | subject | grade | area | maintopic | subtopic | keyword | passageTitle | vocabularyCount | comprehensiveCount | inputData | passageData | vocabularyData | comprehensiveData | paragraphCount | vocabularyWordsCount
```

**새로 추가된 필드:**
- `paragraphCount`: 지문의 실제 단락 개수
- `vocabularyWordsCount`: 지문에 포함된 용어 개수

#### vocabulary_details 시트 (어휘 문제 상세)
```
timestamp | setId | questionId | term | question | options | answer | explanation
```

#### comprehensive_details 시트 (종합 문제 상세) ⭐ **업데이트됨**
```
timestamp | setId | questionId | type | question | options | answer | explanation | isSupplementary | originalQuestionId
```

**보완 문제 시스템:**
- `isSupplementary`: 보완 문제 여부 (TRUE/FALSE)
- `originalQuestionId`: 보완 문제의 경우 기본 문제 ID

#### question_type_stats 시트 (문제 유형별 통계)
```
timestamp | setId | questionType | count
```

## 🏗️ 시스템 구조

### Cascading Dropdown 시스템
교육과정 기반의 계층적 선택 구조:

**구분** → **과목** → **학년** → **영역** → **대주제** → **소주제** → **핵심 개념어**

### 지원 구분 및 과목

**구분 (학습 단계)**
- 초등학교 중학년(3-4학년)
- 초등학교 고학년(5-6학년)  
- 중학생(1-3학년)

**과목 및 영역**
- **사회**: 일반사회, 지리, 역사, 경제
- **과학**: 물리, 화학, 생물, 지구과학

**학년**
- 3학년, 4학년, 5학년, 6학년, 중1, 중2, 중3

### 문제 유형

**어휘 문제**
- 각 용어당 1개씩 생성
- 5지선다 객관식
- 용어의 의미, 사용법, 맥락 평가

**종합 문제 (5가지 유형)**
1. **단답형**: 핵심 내용을 짧은 답으로 작성
2. **문단별 순서 맞추기**: 논리적 전개 순서 파악
3. **핵심 내용 요약**: 전체 내용의 적절한 요약 선택
4. **핵심어/핵심문장 찾기**: 지문의 핵심 요소 파악
5. **Random**: 위 4가지 유형을 3개씩 균등 생성

**세트 구조 (혁신적 관리 방식)**
- **기본문제 1개** + **보완문제 2개** = 1세트
- 세트 단위 추가/삭제
- 시각적 구분 및 독립적 편집

### 지문 형태
- 구분별 맞춤형 단락 구성
- 질문형·호기심 유발형 제목
- 실생활 연계 예시
- 최소 20+개 개념어 풀이 포함

## 📡 API 엔드포인트

### POST `/api/generate-passage`
지문 생성 API

### POST `/api/generate-vocabulary`
어휘 문제 생성 API

### POST `/api/generate-comprehensive`
종합 문제 생성 API

### POST `/api/save-final`
최종 저장 API

### GET `/api/get-field-data`
교육과정 데이터 조회 API

### GET `/api/get-saved-sets`
저장된 콘텐츠 목록 조회 API ⭐ **새로운 기능**
- 필터링: subject, grade, area
- 페이지네이션: limit 매개변수
- 통계 정보 포함

### GET `/api/get-set-details`
개별 콘텐츠 상세 조회 API ⭐ **새로운 기능**
- 완전한 데이터 구조 조회
- 문제별 상세 정보
- 편집을 위한 구조화된 데이터

### POST `/api/update-sheets-schema`
Google Sheets 스키마 업데이트 API ⭐ **새로운 기능**
- 기존 시트에 새 컬럼 추가
- 스키마 버전 관리

## 📁 디렉토리 구조

```
src/
├── app/
│   ├── api/
│   │   ├── generate-passage/         # 지문 생성
│   │   ├── generate-vocabulary/      # 어휘 문제 생성
│   │   ├── generate-comprehensive/   # 종합 문제 생성
│   │   ├── save-final/              # 최종 저장
│   │   ├── get-field-data/          # 교육과정 데이터
│   │   ├── get-saved-sets/          # 콘텐츠 목록 조회 ⭐
│   │   ├── get-set-details/         # 콘텐츠 상세 조회 ⭐
│   │   └── update-sheets-schema/    # 스키마 업데이트 ⭐
│   ├── manage/                      # 콘텐츠 관리 시스템 ⭐
│   │   ├── page.tsx                # 관리 대시보드
│   │   └── [setId]/               # 상세 편집 페이지
│   │       └── page.tsx           # 4탭 편집 시스템
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx                     # 메인 워크플로우
├── components/
│   ├── PassageForm.tsx             # 지문 생성 폼 (1단계)
│   ├── PassageReview.tsx           # 지문 검토&수정 (2단계)
│   ├── VocabularyQuestions.tsx     # 어휘 문제 생성&검토 (3,4단계)
│   ├── ComprehensiveQuestions.tsx  # 종합 문제 생성&검토 (5,6단계)
│   ├── FinalSave.tsx              # 최종 저장 (7단계)
│   ├── PassageDisplay.tsx         # 지문 표시
│   ├── QuestionDisplay.tsx        # 문제 표시
│   └── Header.tsx                 # 공통 헤더 ⭐
├── lib/
│   ├── google-sheets.ts           # Google Sheets API 연동
│   ├── openai.ts                 # OpenAI API 연동
│   └── prompts.ts                # AI 프롬프트 관리
└── types/
    └── index.ts                  # TypeScript 타입 정의
```

## 🚀 배포

### Vercel 배포
1. Vercel 계정에 GitHub 저장소 연결
2. 환경 변수 설정
3. 자동 배포

### 환경 변수 주의사항
- `GOOGLE_SHEETS_PRIVATE_KEY`: 개행 문자(`\n`)와 따옴표 처리 주의
- 키 값은 `-----BEGIN PRIVATE KEY-----`로 시작하고 `-----END PRIVATE KEY-----`로 끝나야 함

## 🔄 워크플로우 특징

### 단계별 제어
- 각 단계에서 완전한 검토 및 수정 가능
- 자동 저장 없음 - 사용자가 원할 때만 진행
- 단계 이동 전 데이터 검증

### 백업 시스템
- Google Sheets 구조화 저장
- 로컬 JSON 파일 다운로드
- 저장 실패 시 백업 데이터 제공

### 사용자 경험
- 진행 상태 시각화 (7단계 진행 바)
- 실시간 미리보기
- 단계별 컬러 코딩
- 반응형 디자인

## 🎯 주요 업데이트 (v2.0)

### 🆕 새로운 기능

**📊 완전한 콘텐츠 관리 시스템**
- 관리 대시보드 (`/manage`)
- 스마트 필터링 및 검색
- 페이지네이션 (20/50/100개)
- 통계 카드 및 데이터 시각화

**🔧 4탭 편집 시스템**
- 지문, 어휘, 어휘문제, 종합문제 개별 편집
- 실시간 저장 기능
- 새창 편집 환경

**🧠 세트 단위 문제 관리**
- 기본문제 + 보완문제 2개 구조
- 시각적 구분 및 독립적 편집
- 객관식 정답 드롭다운 선택

### 🔄 개선된 기능

**📈 데이터 정확성**
- 문단수: 실제 지문 단락 개수
- 어휘수: 지문 용어 개수 (문제 개수와 구분)
- 정확한 데이터 파싱 및 계산

**🎨 사용자 경험**
- 직관적인 탭 구조
- 스마트 페이지네이션
- 향상된 필터링 시스템
- 반응형 디자인 개선

## 📊 생성 결과물

### 완성된 학습 콘텐츠 세트
- **지문**: 제목 + 여러 단락 + 용어 설명
- **어휘 문제**: 용어당 1개씩 (보통 20+개)
- **종합 문제**: 세트 단위 (기본문제 + 보완문제 2개)
- **총 문제 수**: 보통 30-40개 문제

### 문제 형태
- 모든 문제에 해설 포함
- 객관식: 5지선다 (드롭다운 정답 선택)
- 주관식: 단답형
- 난이도: 구분에 따라 자동 조절

## 🛠️ 개발 정보

- **개발 서버**: `npm run dev` → [http://localhost:3000](http://localhost:3000)
- **빌드**: `npm run build`
- **주요 페이지**: 
  - 메인 워크플로우: `/`
  - 콘텐츠 관리: `/manage`
  - 상세 편집: `/manage/[setId]`
- **총 API 엔드포인트**: 8개 (3개 새로 추가)
- **총 컴포넌트**: 8개 (Header 추가)

## 🎯 시스템 활용 방법

### 📝 콘텐츠 생성
1. **신규 생성**: 메인 페이지에서 7단계 워크플로우 진행
2. **검토 및 수정**: 각 단계에서 완전한 편집 가능
3. **최종 저장**: Google Sheets 자동 저장 + JSON 백업

### 📊 콘텐츠 관리
1. **전체 조회**: `/manage`에서 모든 콘텐츠 리스트 확인
2. **필터링**: 과목, 학년, 영역별 필터 + 키워드 검색
3. **페이지네이션**: 효율적인 대량 데이터 관리

### 🔧 상세 편집
1. **개별 편집**: 특정 콘텐츠의 완전한 편집
2. **4탭 시스템**: 지문/어휘/어휘문제/종합문제 독립 편집
3. **실시간 저장**: 모든 변경사항 즉시 반영

### 👥 사용자별 활용
1. **교육자**: 교육과정에 맞는 학습 자료 생성 및 관리
2. **학습자**: 체계적인 문제 해결을 통한 학습
3. **콘텐츠 제작자**: 대량의 교육 콘텐츠 효율적 생성 및 관리
4. **교육 기관**: 표준화된 학습 자료 통합 관리

## 📝 라이선스

MIT License

---

**🚀 완전한 7단계 워크플로우 + 통합 관리 시스템으로 고품질 학습 콘텐츠를 생성하고 관리하세요!**

---

## 🎨 디자인 시스템

### 📋 표준 모달 구조
시스템 전반에 걸쳐 일관된 사용자 경험을 위한 표준 모달 디자인

### 🎯 색상 테마
- **지문 생성**: 파란색 (`blue-600`)
- **어휘 문제**: 보라색 (`purple-600`)
- **종합 문제**: 초록색 (`green-600`)
- **저장/관리**: 빨간색 (`red-600`)

### 📱 반응형 디자인
- 모바일 우선 설계
- 태블릿 및 데스크톱 최적화
- 터치 인터페이스 지원
